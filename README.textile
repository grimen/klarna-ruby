h1. KLARNA

_A Ruby wrapper for the Klarna XML-RPC API._

h2. What is Klarna?

*"Klarna":http://klarna.com* is a payment solution with focus on e-commerce. Visit "klarna.com":http://klarna.com for more information, or why not "Wikipedia: Klarna":http://en.wikipedia.org/wiki/Klarna. We might be biased, but at "Merchii":http://merchii.com we currently consider Klarna the most convenient online payment solution that exists - and that's why we lean on it.

*Supported countries:*

Sweden (SE), Norway (NO), Denmark (DK), Finland (FI), Germany (DE), Netherlands (NL).

h2. Setup

Install the gem:

<pre>
  $ gem install klarna
</pre>

...or if you use "Bundler":http://gembundler.com:

@Gemfile@:

<pre>
  gem 'klarna'
</pre>

...and @$ bundle install@.

h2. Usage

Trivial example looking up an address using - in this case - a Swedish SSN:

<pre>
  require 'rubygems'
  require 'klarna'

  Klarna.configure do |c|
    c.store_id = 2
    c.store_secret = 'lakrits'

    c.mode = :test
    c.http_logging = false
  end

  client = Klarna::API::Client.new

  client.get_addresses("430415-8399", :SE)
</pre>

See the code/docs for more information.

h2. Testing

A couple of ways...

*Specs*

To run unit/integration tests, simply do:

<pre>
  $ bundle exec rake test
</pre>

...or if you use "Guard":http://github.com/guard/guard:

<pre>
  $ bundle exec guard
</pre>

*Dummie client*

<pre>
  $ cd examples
  $ ruby console.rb
</pre>

*Web/Sinatra app*

1. Start the server...

<pre>
  $ cd examples
  $ ruby web.rb
  ...
  >> Listening on 0.0.0.0:4567, CTRL+C to stop
</pre>

2. Open it up!

@http://localhost:4567@

*NOTE:* The web app actions/forms are probably completely broken currently as it hasn't been updated to reflect the current library implementation.

h2. Debugging

*HTTP-debugging in Wireshark*

Ensure port @4567@ (port used for Klarna API integration test/debugging) is in the list of captured ports in the HTTP/HTTPS preferences, or these requests/responses will not be captured. Note: Port @80@ (port used for Klarna API integration in production) is captured by default.

*XML-RPC-debugging in a XML-RPC client*

Try this:

Endpoint: @http://beta-test.klarna.com:4567@
Method: @get_addresses@
Params: @["1.0","ruby/xmlrpc","430415-8399",2,"AY2qnVNi8ccTsuDw2XNovQ==",2,2]@

h2. References

* "Klarna API Documentation":http://integration.klarna.com/en/api/step-by-step
* "XML-RPC Overview":http://en.wikipedia.org/wiki/XML-RPC

h2. Tools

* "XML-RPC Client":http://ditchnet.org/xmlrpc/ for XML-RPC debugging on OS X.
* "Wireshark":http://wireshark.org for platform-independent protocol sniffing, useful for debugging XML-RPC requests/responses.

h2. Notes

This gem was developed for our own requirements at "Merchii":http://github.com/merchii, so feel free to send pull-requests with enhancements of any kind (features, bug-fixes, documentation, tests, etc.) to make it better or useful for you as well.

h2. To-do

This is not a complete implementation, but not far from it though. I had bigger plans way back when we wrote this, but since I assume Klarna will release a completely new API soon (_Klarna 2.0_ which I assume will be REST API?) - we're not sure we will bother to "finish" the planned features for the current XML-RPC API. Time will tell. For more details, see the "TODO":https://github.com/merchii/klarna-ruby/blob/master/TODO.

h2. License

Released under the MIT license.
Copyright (c) "Jonas Grimfelt":http://github.com/grimen, "Merchii":http://merchii.com
